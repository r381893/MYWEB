<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>å¯æ„›ç•™è¨€æ¿</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Noto Sans TC', sans-serif;
      background: linear-gradient(to right, #fff6f6, #fff9f0);
      padding: 2rem;
      max-width: 700px;
      margin: auto;
    }
    h1 {
      font-size: 2rem;
      text-align: center;
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1rem;
    }
    button {
      margin-top: 10px;
      background-color: hotpink;
      border: none;
      padding: 10px 20px;
      border-radius: 10px;
      color: white;
      font-weight: bold;
      font-size: 1rem;
      cursor: pointer;
    }
    .message {
      background-color: white;
      border-radius: 12px;
      padding: 1rem;
      margin-top: 1rem;
      box-shadow: 0 0 5px #ccc;
    }
    .avatar {
      border-radius: 50%;
      width: 40px;
      height: 40px;
      margin-right: 10px;
    }
    .meta {
      font-size: 0.85rem;
      color: gray;
    }
    .result {
      margin-top: 10px;
    }
    .counter {
      text-align: center;
      margin-bottom: 1rem;
      font-size: 0.9rem;
      color: #666;
    }
  </style>
</head>
<body>
  <h1>ğŸ° å¯æ„›ç•™è¨€æ¿ ğŸ©</h1>
  <div class="counter">
    ğŸ” æ­¤é å·²è¢«ç€è¦½ <span id="viewCount">0</span> æ¬¡
    ã€å·²æœ‰ <span id="msgCount">0</span> å‰‡ç•™è¨€
  </div>
  <input type="text" id="name" placeholder="ä½ çš„åå­—">
  <textarea id="message" placeholder="èªªé»ä»€éº¼..."></textarea>
  <button onclick="submitMessage()">é€å‡ºç•™è¨€</button>
  <p class="result" id="result"></p>
  <div id="messages"></div>

  <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec'; // æ›æˆä½ è‡ªå·±çš„ URL

    // è¢«ç€è¦½æ¬¡æ•¸
    let viewCount = localStorage.getItem("viewCount") || 0;
    viewCount++;
    localStorage.setItem("viewCount", viewCount);
    document.getElementById("viewCount").textContent = viewCount;

    // é€å‡ºç•™è¨€
    function submitMessage() {
      const name = document.getElementById("name").value.trim() || "åŒ¿å";
      const message = document.getElementById("message").value.trim();
      if (!message) return;

      const formData = new URLSearchParams();
      formData.append("name", name);
      formData.append("message", message);

      fetch(SCRIPT_URL, { method: "POST", body: formData })
        .then((res) => res.text())
        .then((data) => {
          document.getElementById("result").textContent = "âœ… ç•™è¨€æˆåŠŸ";
          document.getElementById("message").value = "";
          loadMessages();
        })
        .catch((err) => {
          document.getElementById("result").textContent = "âŒ ç™¼ç”ŸéŒ¯èª¤";
        });
    }

    // è¼‰å…¥ç•™è¨€
    function loadMessages() {
      fetch(SCRIPT_URL)
        .then((res) => res.json())
        .then((data) => {
          const container = document.getElementById("messages");
          document.getElementById("msgCount").textContent = data.length;
          container.innerHTML = "";
          data.reverse().forEach((entry, index) => {
            const div = document.createElement("div");
            div.className = "message";
            const avatarSeed = entry.name + index;
            div.innerHTML = `
              <div style="display:flex;align-items:center;">
                <img class="avatar" src="https://api.dicebear.com/7.x/thumbs/svg?seed=${encodeURIComponent(avatarSeed)}" alt="avatar">
                <div>
                  <strong>ğŸ•µï¸ ${entry.name}</strong><br>
                  <span class="meta">ğŸ•’ ${entry.time}</span>
                </div>
              </div>
              <div style="margin-top:10px; white-space:pre-line;">${entry.message}</div>
            `;
            container.appendChild(div);
          });
        });
    }

    window.onload = loadMessages;
  </script>
</body>
</html>
